import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;
import org.springframework.beans.factory.annotation.Autowired;

@Repository
public class MyRepository {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    public void updateJsonField(String fieldName, Object newValue, int id) {
        String sql;

        // Construct SQL based on the field to be updated
        if ("retry_count".equals(fieldName)) {
            sql = "UPDATE my_table " +
                  "SET job_run_parameter = COALESCE(" +
                  "    jsonb_set(job_run_parameter::jsonb, '{retry_count}', '" + newValue + "', true)," +
                  "    '{\"retry_count\": " + newValue + "}'::json" +
                  ")::json " +
                  "WHERE id = " + id;
        } else if ("status".equals(fieldName)) {
            sql = "UPDATE my_table " +
                  "SET job_run_parameter = COALESCE(" +
                  "    jsonb_set(job_run_parameter::jsonb, '{status}', '\"" + newValue + "\"', true)," +
                  "    '{\"status\": \"" + newValue + "\"}'::json" +
                  ")::json " +
                  "WHERE id = " + id;
        } else {
            throw new IllegalArgumentException("Unsupported field: " + fieldName);
        }

        // Execute the constructed SQL query
        jdbcTemplate.update(sql);
    }
}

openapi: 3.0.0
info:
  title: Formulary Placement API
  description: API to query drug placement in a formulary for a given year, utilizing OpenSearch and Azure OpenAI for responses.
  version: 1.0.0
servers:
  - url: https://your-api-gateway-url.amazonaws.com/prod
    description: Production Server

paths:
  /query:
    post:
      summary: Query formulary placement
      description: Retrieve information about drug placement in a formulary for a given year.
      operationId: queryFormularyPlacement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QueryRequest"
      responses:
        "200":
          description: Successful response with AI-generated insights.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QueryResponse"
        "400":
          description: Invalid request format.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    QueryRequest:
      type: object
      properties:
        query:
          type: string
          description: The user query about drug placement.
        history:
          type: array
          items:
            type: object
            properties:
              role:
                type: string
                enum: [user, assistant]
              content:
                type: string
          description: Conversation history to maintain context.

    QueryResponse:
      type: object
      properties:
        response:
          type: string
          description: AI-generated response in natural language.
        additional_info:
          type: string
          description: Pagination information if more results are available.

    ErrorResponse:
      type: object
      properties:
        error_code:
          type: string
          description: The error code identifier.
        error_message:
          type: string
          description: Detailed error message explaining the issue.
        details:
          type: object
          description: Additional details about the error.
          additionalProperties:
            type: string
